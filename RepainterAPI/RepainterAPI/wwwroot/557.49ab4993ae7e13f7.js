"use strict";(self.webpackChunkRepainters=self.webpackChunkRepainters||[]).push([[557],{2557:(ee,f,l)=>{l.r(f),l.d(f,{CustomerModule:()=>K});var u=l(177),m=l(33),e=l(7705);let M=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-customer"]],decls:1,vars:0,template:function(n,o){1&n&&e.nrm(0,"router-outlet")},dependencies:[m.n3]})}}return r})();var j=l(4585),h=l(65),c=l(9417);function k(r,a){if(1&r){const t=e.RV6();e.j41(0,"tr",16),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.selectCustomer(i))}),e.j41(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s()()}if(2&r){const t=a.$implicit,n=a.index;e.R7$(2),e.JRh(n+1),e.R7$(2),e.JRh(t.enquiryId),e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.projectName)}}function w(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.closeModal(o))}),e.j41(1,"div",2),e.bIt("click",function(o){return o.stopPropagation()}),e.j41(2,"div",3)(3,"h2"),e.EFF(4,"Customer List"),e.k0s(),e.j41(5,"button",4),e.bIt("click",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.closeModal(o))}),e.EFF(6,"\xd7"),e.k0s()(),e.j41(7,"div",5)(8,"div",6)(9,"input",7),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.searchTerm=o)})("keyup",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.applyFilters())}),e.k0s()(),e.j41(10,"div",8)(11,"select",9),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.sortField=o)})("change",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.applyFilters())}),e.j41(12,"option",10),e.EFF(13,"Customer ID"),e.k0s(),e.j41(14,"option",11),e.EFF(15,"Customer Name"),e.k0s(),e.j41(16,"option",12),e.EFF(17,"Project Name"),e.k0s()(),e.j41(18,"button",13),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.toggleSortOrder())}),e.EFF(19),e.k0s()()(),e.j41(20,"div",14)(21,"table")(22,"thead")(23,"tr")(24,"th"),e.EFF(25,"SI No"),e.k0s(),e.j41(26,"th"),e.EFF(27,"Customer ID"),e.k0s(),e.j41(28,"th"),e.EFF(29,"Customer Name"),e.k0s(),e.j41(30,"th"),e.EFF(31,"Project Name"),e.k0s()()(),e.j41(32,"tbody"),e.DNE(33,k,9,4,"tr",15),e.k0s()()()()()}if(2&r){const t=e.XpG();e.R7$(9),e.Y8G("ngModel",t.searchTerm),e.R7$(2),e.Y8G("ngModel",t.sortField),e.R7$(8),e.SpI(" ",t.sortAscending?"\u2191":"\u2193"," "),e.R7$(14),e.Y8G("ngForOf",t.filteredCustomers)}}let b=(()=>{class r{constructor(t){this.customerProvider=t,this.isVisible=!1,this.customers=[],this.filteredCustomers=[],this.searchTerm="",this.sortField="custId",this.sortAscending=!0,this.customerSelected=new e.bkB}ngOnInit(){this.customerProvider.customer.subscribe(t=>{this.customers=t,this.applyFilters()})}showModal(){this.isVisible=!0}closeModal(t){this.isVisible=!1}applyFilters(){let t=[...this.customers];if(this.searchTerm){const n=this.searchTerm.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(n)||o.projectName.toLowerCase().includes(n)||o.enquiryId.toString().includes(n))}t.sort((n,o)=>{let i=this.getSortValue(n),s=this.getSortValue(o);return this.sortAscending?i<s?-1:i>s?1:0:i>s?-1:i<s?1:0}),this.filteredCustomers=t}getSortValue(t){switch(this.sortField){case"custId":default:return t.enquiryId;case"name":return t.name;case"projectName":return t.projectName}}toggleSortOrder(){this.sortAscending=!this.sortAscending,this.applyFilters()}selectCustomer(t){this.customerSelected.emit(t),this.closeModal()}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(h.y))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-customer-modal"]],outputs:{customerSelected:"customerSelected"},decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"search-sort-container"],[1,"search-box"],["type","text","placeholder","Search customers...",1,"search-input",3,"ngModel","ngModelChange","keyup"],[1,"sort-box"],[1,"sort-select",3,"ngModel","ngModelChange","change"],["value","custId"],["value","name"],["value","projectName"],[1,"sort-direction",3,"click"],[1,"table-container"],["style","cursor: pointer;",3,"click",4,"ngFor","ngForOf"],[2,"cursor","pointer",3,"click"]],template:function(n,o){1&n&&e.DNE(0,w,34,4,"div",0),2&n&&e.Y8G("ngIf",o.isVisible)},dependencies:[u.Sq,u.bT,c.xH,c.y7,c.me,c.wz,c.BC,c.vS],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:white;padding:20px;border-radius:8px;width:80%;max-width:900px;max-height:80vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer}.search-sort-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:20px}.search-input[_ngcontent-%COMP%]{padding:8px;width:300px;border:1px solid #ddd;border-radius:4px}.sort-box[_ngcontent-%COMP%]{display:flex;gap:10px}.sort-select[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;border-radius:4px}.sort-direction[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;cursor:pointer}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #ddd}th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:700}tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}"]})}}return r})();var _=l(980),F=l(6813),y=l(8032),C=l.n(y),I=l(1382),O=l(5794),x=l(4037),v=l(8834);const V=["floorPlanInput"],T=["sitePlanInput"];function N(r,a){1&r&&(e.j41(0,"div",13)(1,"div",14)(2,"p"),e.EFF(3,"No customer records found. Please create a new customer."),e.k0s(),e.j41(4,"button",15),e.EFF(5," Create New Customer "),e.k0s()()())}function G(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"p"),e.EFF(3),e.k0s(),e.j41(4,"button",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.clearSearch())}),e.EFF(5," Clear Search "),e.k0s()()()}if(2&r){const t=e.XpG();e.R7$(3),e.SpI('No customers found matching your search criteria: "',t.searchTerm,'"')}}function B(r,a){1&r&&(e.qex(0),e.EFF(1," \u{1f4c4} Upload Floor Plan "),e.bVm())}function E(r,a){1&r&&(e.qex(0),e.EFF(1," Uploading... "),e.bVm())}const P=function(r){return{loading:r}};function S(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",44)(1,"img",45),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.openImagePreview(i))}),e.k0s(),e.j41(2,"div",46)(3,"button",47),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.openImagePreview(i))}),e.EFF(4,"\u{1f441}"),e.k0s(),e.j41(5,"button",48),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.downloadImage(s.getImageUrl(i)))}),e.EFF(6,"\u2b07"),e.k0s()()()}if(2&r){const t=a.$implicit,n=e.XpG(3);e.R7$(1),e.Y8G("src",n.getImageUrl(t),e.B4B)("ngClass",e.eq3(2,P,n.uploadingFloorPlan))}}function D(r,a){if(1&r&&(e.j41(0,"div",42),e.DNE(1,S,7,4,"div",43),e.k0s()),2&r){const t=e.XpG(2);e.R7$(1),e.Y8G("ngForOf",t.getImageArray(t.selectedCustomer.floorPlan))}}function $(r,a){1&r&&(e.j41(0,"div",49),e.EFF(1," No floor plan images uploaded "),e.k0s())}function R(r,a){1&r&&(e.qex(0),e.EFF(1," \u{1f4c4} Upload Site Plan "),e.bVm())}function X(r,a){1&r&&(e.qex(0),e.EFF(1," Uploading... "),e.bVm())}function Y(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",44)(1,"img",50),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.openImagePreview(i))}),e.k0s(),e.j41(2,"div",46)(3,"button",47),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.openImagePreview(i))}),e.EFF(4,"\u{1f441}"),e.k0s(),e.j41(5,"button",48),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.downloadImage(s.getImageUrl(i)))}),e.EFF(6,"\u2b07"),e.k0s()()()}if(2&r){const t=a.$implicit,n=e.XpG(3);e.R7$(1),e.Y8G("src",n.getImageUrl(t),e.B4B)("ngClass",e.eq3(2,P,n.uploadingSitePlan))}}function z(r,a){if(1&r&&(e.j41(0,"div",42),e.DNE(1,Y,7,4,"div",43),e.k0s()),2&r){const t=e.XpG(2);e.R7$(1),e.Y8G("ngForOf",t.getImageArray(t.selectedCustomer.sitePlan))}}function A(r,a){1&r&&(e.j41(0,"div",49),e.EFF(1," No site plan images uploaded "),e.k0s())}function L(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",51),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.closeImagePreview())}),e.j41(1,"span",52),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.closeImagePreview())}),e.EFF(2,"\xd7"),e.k0s(),e.nrm(3,"img",53),e.j41(4,"a",54),e.EFF(5,"Download"),e.k0s()()}if(2&r){const t=e.XpG(2);e.R7$(3),e.Y8G("src",t.previewImage,e.B4B),e.R7$(1),e.Y8G("href",t.previewImage,e.B4B)}}function U(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",17)(1,"div",18)(2,"label"),e.EFF(3,"Customer Title:"),e.k0s(),e.j41(4,"input",19),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.title=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(5,"div",18)(6,"label"),e.EFF(7,"Customer Name:"),e.k0s(),e.j41(8,"input",19),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.name=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(9,"div",18)(10,"label"),e.EFF(11,"Customer Address:"),e.k0s(),e.j41(12,"textarea",20),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.city=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(13,"div",18)(14,"label"),e.EFF(15,"Phone Number:"),e.k0s(),e.j41(16,"input",21),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.phoneNumber=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(17,"div",18)(18,"label"),e.EFF(19,"Project Name:"),e.k0s(),e.j41(20,"input",19),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.projectName=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(21,"div",18)(22,"label"),e.EFF(23,"Project Type:"),e.k0s(),e.j41(24,"input",19),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.projectType=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(25,"div",18)(26,"label"),e.EFF(27,"Configuration:"),e.k0s(),e.j41(28,"input",19),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedCustomer.configurtion=o)})("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateCustomer())}),e.k0s()(),e.j41(29,"div",22)(30,"div",23)(31,"span",24),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.viewCustomer(o.selectedCustomer))}),e.EFF(32,"\u{1f441}"),e.k0s(),e.j41(33,"span",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.navigateToQuotationBuilder(o.selectedCustomer))}),e.EFF(34,"\u27a1"),e.k0s(),e.j41(35,"span",26),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.deleteCustomer(o.selectedCustomer))}),e.EFF(36,"\u{1f5d1}"),e.k0s()()(),e.j41(37,"div",27)(38,"div",28)(39,"div",29)(40,"h3"),e.EFF(41,"Floor Plan"),e.k0s(),e.j41(42,"div",22)(43,"button",30),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.refreshImages())}),e.j41(44,"span"),e.EFF(45,"\u{1f504}"),e.k0s()(),e.j41(46,"label",31)(47,"span",32),e.DNE(48,B,2,0,"ng-container",33),e.DNE(49,E,2,0,"ng-container",33),e.k0s(),e.j41(50,"input",34,35),e.bIt("change",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.onFileSelected(o,"floorPlan"))}),e.k0s()()()(),e.j41(52,"div",36),e.DNE(53,D,2,1,"div",37),e.DNE(54,$,2,0,"div",38),e.k0s()(),e.j41(55,"div",28)(56,"div",29)(57,"h3"),e.EFF(58,"Site Plan"),e.k0s(),e.j41(59,"div",22)(60,"button",30),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.refreshImages())}),e.j41(61,"span"),e.EFF(62,"\u{1f504}"),e.k0s()(),e.j41(63,"label",31)(64,"span",32),e.DNE(65,R,2,0,"ng-container",33),e.DNE(66,X,2,0,"ng-container",33),e.k0s(),e.j41(67,"input",34,39),e.bIt("change",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.onFileSelected(o,"sitePlan"))}),e.k0s()()()(),e.j41(69,"div",36),e.DNE(70,z,2,1,"div",37),e.DNE(71,A,2,0,"div",38),e.k0s()()(),e.DNE(72,L,6,2,"div",40),e.j41(73,"app-customer-modal",41),e.bIt("customerSelected",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.selectCustomer(o))}),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.title),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.name),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.city),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.phoneNumber),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.projectName),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.projectType),e.R7$(4),e.Y8G("ngModel",t.selectedCustomer.configurtion),e.R7$(18),e.AVh("disabled",t.uploadingFloorPlan),e.R7$(2),e.Y8G("ngIf",!t.uploadingFloorPlan),e.R7$(1),e.Y8G("ngIf",t.uploadingFloorPlan),e.R7$(1),e.Y8G("disabled",t.uploadingFloorPlan),e.R7$(3),e.Y8G("ngIf",null==t.selectedCustomer||null==t.selectedCustomer.floorPlan?null:t.selectedCustomer.floorPlan.length),e.R7$(1),e.Y8G("ngIf",!(null!=t.selectedCustomer&&null!=t.selectedCustomer.floorPlan&&t.selectedCustomer.floorPlan.length)),e.R7$(9),e.AVh("disabled",t.uploadingSitePlan),e.R7$(2),e.Y8G("ngIf",!t.uploadingSitePlan),e.R7$(1),e.Y8G("ngIf",t.uploadingSitePlan),e.R7$(1),e.Y8G("disabled",t.uploadingSitePlan),e.R7$(3),e.Y8G("ngIf",null==t.selectedCustomer||null==t.selectedCustomer.sitePlan?null:t.selectedCustomer.sitePlan.length),e.R7$(1),e.Y8G("ngIf",!(null!=t.selectedCustomer&&null!=t.selectedCustomer.sitePlan&&t.selectedCustomer.sitePlan.length)),e.R7$(1),e.Y8G("ngIf",t.previewImage)}}const J=[{path:"",component:M,children:[{path:"view",component:(()=>{class r{constructor(t,n,o,i){this.customerProvider=t,this.customerService=n,this.router=o,this.toastr=i,this.baseUrl=F.c.backend.baseURL,this.uploadingFloorPlan=!1,this.uploadingSitePlan=!1,this.previewImage=null,this.currentCustomer=new j.n,this.isSidebarCollapsed=!1,this.customers=[],this.selectedCustomer=null,this.currentPage=1,this.pages=Array(10).fill(0).map((s,p)=>p+1),this.filteredCustomers=[],this.pageSize=10,this.searchTerm=""}ngOnInit(){this.customerProvider.customer.subscribe(t=>{this.customers=t,this.filteredCustomers=[...t],this.customers.length>0&&!this.selectedCustomer&&this.selectCustomer(this.customers[0])})}ngAfterViewInit(){setTimeout(()=>{console.log("Modal component:",this.customerListModal)})}toggleSidebar(){this.isSidebarCollapsed=!this.isSidebarCollapsed}searchCustomers(t){const n=this.searchTerm.trim().toLowerCase();this.filteredCustomers=n?this.customers.filter(o=>o.name.toLowerCase().includes(n)||o.phoneNumber.includes(n)||o.enquiryId.toLowerCase().includes(n)||o.projectName.toLowerCase().includes(n)||o.city.toLowerCase().includes(n)):[...this.customers],this.filteredCustomers.length>0?this.selectCustomer(this.filteredCustomers[0]):this.selectedCustomer=null}get totalPages(){return Math.ceil(this.filteredCustomers.length/this.pageSize)}get paginatedCustomers(){const t=(this.currentPage-1)*this.pageSize;return this.filteredCustomers.slice(t,t+this.pageSize)}setPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)}clearSearch(){this.searchTerm="",this.filteredCustomers=[...this.customers],this.customers.length>0&&this.selectCustomer(this.customers[0])}selectCustomer(t){this.selectedCustomer={...t},this.loadCustomerImages()}viewCustomer(t){t&&t.id?this.router.navigate(["/customer/edit",t.id]):console.error("No customer selected or invalid customer ID")}nextCustomer(){const t=this.customers.findIndex(n=>n.id===this.selectedCustomer?.id);t<this.customers.length-1&&this.selectCustomer(this.customers[t+1])}openCustomerList(){this.customerListModal?this.customerListModal.showModal():console.error("Modal component not initialized")}deleteCustomer(t){t&&t.id?C().fire({title:"Are you sure?",text:`Do you want to delete ${t.name}'s record? This action cannot be undone!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(n=>{n.isConfirmed&&this.customerProvider.deleteCustomer(t).subscribe({next:()=>{C().fire("Deleted!",`${t.name}'s record has been deleted.`,"success")},error:o=>{console.error("Error deleting customer:",o),C().fire("Error!","There was an error deleting the customer.","error")}})}):console.error("No customer selected or invalid customer ID")}addNewCustomer(){const t=localStorage.getItem("UserId");if(!t)return void this.toastr.error("User ID not found, Please try logging in again.");const n={id:0,enquiryId:"0",title:"",name:"",emailId:"",phoneNumber:"",alternatePhoneNumber:"",projectName:"",houseNo:"",projectType:"",configurtion:"",carpetArea:"",projectLocation:"",city:"",floorPlan:[],sitePlan:[],deleted:!1,lastModified:new Date,lastModifiedBy:parseInt(t),createdOn:new Date,createdBy:parseInt(t)};this.customerProvider.addCustomer(n,[],[]).subscribe({next:s=>{s.success?this.toastr.success("Customer added successfully"):this.toastr.error("Failed to add customer")},error:s=>{console.error("Error adding customer:",s),this.toastr.error(s.message||"Failed to add customer")}})}getImageUrl(t){if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;const n=t.startsWith("/")?t.substring(1):t;return`${this.baseUrl.endsWith("/")?this.baseUrl:`${this.baseUrl}/`}${n}`}getImageArray(t){if(!t)return[];if("string"==typeof t){if(t.includes(","))return t.split(",").map(n=>n.trim());try{const n=JSON.parse(t);return Array.isArray(n)?n:[t]}catch{return[t]}}return t}onFileSelected(t,n){const o=t.target,i=o.files;if(!i||0===i.length)return void this.toastr.error("No file selected");if(!this.selectedCustomer)return void this.toastr.error("No customer selected");const s="floorPlan"===n?"floor":"site",p=Array.from(i).filter(d=>this.isValidFileType(d)?!!this.isValidFileSize(d)||(this.toastr.error(`File ${d.name} is too large`),!1):(this.toastr.error(`Invalid file type for ${d.name}`),!1));0!==p.length?("floorPlan"===n?this.uploadingFloorPlan=!0:this.uploadingSitePlan=!0,this.customerProvider.uploadMultipleImages(this.selectedCustomer.id,p,s).pipe((0,_.j)(()=>{o.value="","floorPlan"===n?this.uploadingFloorPlan=!1:this.uploadingSitePlan=!1})).subscribe({next:d=>{const g=d.filter(Z=>Z.success).length;g>0&&(this.toastr.success(`Successfully uploaded ${g} images`),this.loadCustomerImages()),g<p.length&&this.toastr.warning(`Failed to upload ${p.length-g} images`)},error:d=>{console.error("Upload error:",d),this.toastr.error("Failed to upload images")}})):o.value=""}loadCustomerImages(){this.selectedCustomer&&this.customerService.getImagesById(this.selectedCustomer.id).pipe((0,_.j)(()=>{this.uploadingFloorPlan=!1,this.uploadingSitePlan=!1})).subscribe({next:t=>{t.success&&t.data?this.selectedCustomer&&(this.selectedCustomer={...this.selectedCustomer,floorPlan:t.data.floorPlan||[],sitePlan:t.data.sitePlan||[]}):this.toastr.error(t.message||"Failed to load customer images")},error:t=>{console.error("Error loading customer images:",t),this.toastr.error("Failed to load customer images")}})}resetUploadState(t){"floorPlan"===t?this.uploadingFloorPlan=!1:this.uploadingSitePlan=!1}isValidFileType(t){return["image/jpeg","image/png","image/jpg"].includes(t.type)}isValidFileSize(t){return t.size<=104857600}refreshImages(){this.selectedCustomer&&this.loadCustomerImages()}refreshCustomerImages(){this.selectedCustomer&&this.customerService.getCustomerById(this.selectedCustomer.id).pipe((0,_.j)(()=>{this.uploadingFloorPlan=!1,this.uploadingSitePlan=!1})).subscribe({next:t=>{if(t){this.selectedCustomer={...t,floorPlan:this.getImageArray(t.floorPlan),sitePlan:this.getImageArray(t.sitePlan)};const n=this.customers.findIndex(o=>o.id===t.id);-1!==n&&(this.customers[n]=this.selectedCustomer,this.filteredCustomers=this.applySearch(this.customers))}},error:t=>{console.error("Error refreshing customer images:",t),this.toastr.error("Failed to refresh images")}})}downloadImage(t){const n=document.createElement("a");n.href=t,n.download=t.split("/").pop()||"image",document.body.appendChild(n),n.click(),document.body.removeChild(n)}openImagePreview(t){this.previewImage=this.getImageUrl(t)}closeImagePreview(){this.previewImage=null}refreshCustomerData(){this.selectedCustomer&&this.customerService.getCustomerById(this.selectedCustomer.id).subscribe({next:t=>{t?this.selectedCustomer={...t,floorPlan:this.getImageArray(t.floorPlan),sitePlan:this.getImageArray(t.sitePlan)}:this.toastr.error("Customer not found")},error:t=>{console.error("Error refreshing customer data:",t)}})}updateCustomer(){this.selectedCustomer&&this.customerProvider.updateCustomer(this.selectedCustomer)}applySearch(t){if(!this.searchTerm)return[...t];const n=this.searchTerm.toLowerCase();return t.filter(o=>o.name.toLowerCase().includes(n)||o.phoneNumber.includes(n)||o.enquiryId.toLowerCase().includes(n)||o.projectName.toLowerCase().includes(n)||o.city.toLowerCase().includes(n))}trackByCustomerId(t,n){return n.id}navigateToQuotationBuilder(t){t&&t.id?(console.log("Navigating to quotation builder with customer:",t),this.router.navigate(["/quotation-builder/view",t.id])):console.error("No customer selected or invalid customer ID")}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(h.y),e.rXU(I.m),e.rXU(m.Ix),e.rXU(O.tw))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-customer-view"]],viewQuery:function(n,o){if(1&n&&(e.GBs(b,5),e.GBs(V,5),e.GBs(T,5)),2&n){let i;e.mGM(i=e.lsd())&&(o.customerListModal=i.first),e.mGM(i=e.lsd())&&(o.floorPlanInput=i.first),e.mGM(i=e.lsd())&&(o.sitePlanInput=i.first)}},inputs:{currentCustomer:"currentCustomer"},decls:18,vars:8,consts:[[1,"customer-container"],[1,"header"],["routerLink","/enquiry/view",1,"add-customer-btn"],[1,"sidebar"],[1,"content-wrapper"],[1,"left-panel"],[1,"search-box"],["type","text","placeholder","Search customers...",1,"search-input",3,"ngModel","keyup.enter","ngModelChange"],[1,"search-icon",3,"click"],["mat-flat-button","",1,"list-customer-btn",2,"height","50px","margin-left","10px",3,"click"],[1,"right-panel",2,"width","800px"],["class","no-records-message",4,"ngIf"],["class","customer-details",4,"ngIf"],[1,"no-records-message"],[1,"message-container"],["routerLink","/enquiry/view",1,"create-customer-btn"],[1,"clear-search-btn",3,"click"],[1,"customer-details"],[1,"detail-field"],["type","text",3,"ngModel","ngModelChange","blur"],[3,"ngModel","ngModelChange","blur"],["type","tel",3,"ngModel","ngModelChange","blur"],[1,"action-buttons"],[1,"action-icons"],["title","View",1,"icon",3,"click"],["title","Next",1,"icon",3,"click"],["title","Delete",1,"icon",3,"click"],[1,"images-container"],[1,"image-section"],[1,"section-header"],["title","Refresh Images",1,"refresh-button",3,"click"],[1,"upload-button"],[1,"upload-icon"],[4,"ngIf"],["type","file","accept","image/jpeg,image/png,image/jpg","multiple","",2,"display","none",3,"disabled","change"],["floorPlanInput",""],[1,"image-preview"],["class","image-grid",4,"ngIf"],["class","no-image",4,"ngIf"],["sitePlanInput",""],["class","image-preview-modal",3,"click",4,"ngIf"],[3,"customerSelected"],[1,"image-grid"],["class","image-item",4,"ngFor","ngForOf"],[1,"image-item"],["alt","Floor Plan",3,"src","ngClass","click"],[1,"image-overlay"],[1,"preview-btn",3,"click"],[1,"download-btn",3,"click"],[1,"no-image"],["alt","Site Plan",3,"src","ngClass","click"],[1,"image-preview-modal",3,"click"],[1,"close-button",3,"click"],["alt","Preview",3,"src"],["download","",1,"download-button",3,"href"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.EFF(3," \uff0b Add New Customer "),e.k0s()(),e.j41(4,"div",3),e.nrm(5,"app-view"),e.k0s(),e.j41(6,"div",4)(7,"div",5)(8,"div",6)(9,"input",7),e.bIt("keyup.enter",function(s){return o.searchCustomers(s)})("ngModelChange",function(s){return o.searchTerm=s}),e.k0s(),e.j41(10,"span",8),e.bIt("click",function(s){return o.searchCustomers(s)}),e.EFF(11,"\u{1f50d}"),e.k0s()(),e.j41(12,"button",9),e.bIt("click",function(){return o.openCustomerList()}),e.EFF(13,"List Customer"),e.k0s()(),e.j41(14,"div",10),e.DNE(15,N,6,0,"div",11),e.DNE(16,G,6,1,"div",11),e.DNE(17,U,74,22,"div",12),e.k0s()()()),2&n&&(e.R7$(4),e.AVh("collapsed",o.isSidebarCollapsed),e.R7$(2),e.AVh("expanded",o.isSidebarCollapsed),e.R7$(3),e.Y8G("ngModel",o.searchTerm),e.R7$(6),e.Y8G("ngIf",!o.customers||0===o.customers.length),e.R7$(1),e.Y8G("ngIf",o.customers.length>0&&0===o.filteredCustomers.length&&""!==o.searchTerm.trim()),e.R7$(1),e.Y8G("ngIf",o.selectedCustomer&&o.filteredCustomers.length>0))},dependencies:[u.YU,u.Sq,u.bT,m.Wk,c.me,c.BC,c.vS,x.v,v.$z,b],styles:['@import"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css";*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}.customer-container[_ngcontent-%COMP%]{padding:30px;background-image:url(/assets/customerwallpaper.png);background-repeat:no-repeat;background-size:cover;width:100%;height:100%;min-height:100vh}.sidebar[_ngcontent-%COMP%]{width:250px;background-color:#fff;border-right:1px solid #e0e0e0;height:100vh;position:fixed;left:0;top:0;z-index:100;box-shadow:2px 0 8px #0000000d}.header[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:30px}.add-customer-btn[_ngcontent-%COMP%]{padding:12px 24px;background-color:#75ba9d;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:500;font-size:14px;transition:all .3s ease;box-shadow:0 2px 4px #0000001a}.add-customer-btn[_ngcontent-%COMP%]:hover{background-color:#69a88d;transform:translateY(-1px)}.content-wrapper[_ngcontent-%COMP%]{gap:30px;margin-left:300px}.left-panel[_ngcontent-%COMP%]{width:350px;display:flex;flex-direction:row}.search-box[_ngcontent-%COMP%]{position:relative;margin-bottom:25px}.search-input[_ngcontent-%COMP%]{width:100%;padding:14px 40px 14px 16px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;background-color:#fff;transition:all .3s ease;font-weight:300}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#75ba9d;box-shadow:0 0 0 3px #75ba9d1a}.search-icon[_ngcontent-%COMP%]{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#b5ac9c}.customer-list[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000d;overflow:hidden}.customer-item[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #f0f0f0;cursor:pointer;transition:all .3s ease;font-size:14px;color:#333}.customer-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.customer-item.active[_ngcontent-%COMP%]{background-color:#75ba9d1a;border-left:3px solid #75ba9d}.no-records-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:300px;width:100%;background-color:#f5f5f5;border-radius:8px}.message-container[_ngcontent-%COMP%]{text-align:center;padding:2rem}.message-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#666;margin-bottom:1.5rem}.create-customer-btn[_ngcontent-%COMP%], .clear-search-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;transition:background-color .2s}.create-customer-btn[_ngcontent-%COMP%]:hover, .clear-search-btn[_ngcontent-%COMP%]:hover{background-color:#0056b3}.clear-search-btn[_ngcontent-%COMP%]{background-color:#6c757d}.clear-search-btn[_ngcontent-%COMP%]:hover{background-color:#545b62}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px;gap:8px}.images-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;margin-bottom:20px}.image-section[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;background-color:#f9f9f9}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.upload-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:8px 16px;background-color:#4a6fdc;color:#fff;border-radius:4px;cursor:pointer;transition:background-color .3s}.upload-button[_ngcontent-%COMP%]:hover{background-color:#3a5bb9}.upload-button.disabled[_ngcontent-%COMP%]{background-color:#b0b0b0;cursor:not-allowed}.image-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:15px}.image-item[_ngcontent-%COMP%]{position:relative;overflow:hidden;border-radius:4px;box-shadow:0 2px 5px #0000001a;aspect-ratio:4/3;background-color:#eee}.image-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s}.image-item[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.05)}.image-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background-color:#0009;display:flex;justify-content:space-evenly;padding:8px 0;opacity:0;transition:opacity .3s}.image-item[_ngcontent-%COMP%]:hover   .image-overlay[_ngcontent-%COMP%]{opacity:1}.preview-btn[_ngcontent-%COMP%], .download-btn[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-size:18px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background-color .3s}.preview-btn[_ngcontent-%COMP%]:hover, .download-btn[_ngcontent-%COMP%]:hover{background-color:#fff3}.no-image[_ngcontent-%COMP%]{padding:30px;text-align:center;color:#888;font-style:italic;background-color:#f0f0f0;border-radius:4px}.loading[_ngcontent-%COMP%]{opacity:.5}.image-preview-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000000e6;display:flex;justify-content:center;align-items:center;z-index:1000}.image-preview-modal[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:90%;max-height:90%;object-fit:contain}.close-button[_ngcontent-%COMP%]{position:absolute;top:20px;right:30px;color:#fff;font-size:30px;cursor:pointer}.download-button[_ngcontent-%COMP%]{position:absolute;bottom:20px;background-color:#4a6fdc;color:#fff;padding:10px 20px;border-radius:4px;text-decoration:none;transition:background-color .3s}.download-button[_ngcontent-%COMP%]:hover{background-color:#3a5bb9}@media (min-width: 768px){.images-container[_ngcontent-%COMP%]{flex-direction:row}.image-section[_ngcontent-%COMP%]{flex:1}}@media (max-width: 767px){.image-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}}.action-buttons[_ngcontent-%COMP%]{margin:15px 0}.action-icons[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center}.icon[_ngcontent-%COMP%]{cursor:pointer;padding:5px;border-radius:4px;transition:background-color .2s}.icon[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.gallery-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:1000;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{max-width:90%;max-height:90%;background:white;padding:20px;position:relative;overflow:auto}.gallery-images[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}.gallery-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover}.close[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px;cursor:pointer;font-size:24px}.upload-icon[_ngcontent-%COMP%]{border-style:solid;background:#e3f2fd}.upload-section[_ngcontent-%COMP%]{margin-top:15px;text-align:left}.upload-btn[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;display:inline-flex;align-items:center;gap:8px;transition:background-color .2s}.upload-btn[_ngcontent-%COMP%]:hover{background-color:#1976d2}.upload-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.page-btn[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e0e0e0;background:white;cursor:pointer;border-radius:6px;font-size:14px;transition:all .3s ease;color:#666}.page-btn[_ngcontent-%COMP%]:hover{border-color:#b5ac9c;color:#b5ac9c}.page-btn.active[_ngcontent-%COMP%]{background-color:#75ba9d;color:#fff;border-color:#75ba9d}.right-panel[_ngcontent-%COMP%]{flex:1}.customer-details[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:12px;box-shadow:0 2px 8px #0000000d}.detail-field[_ngcontent-%COMP%]{margin-bottom:24px}.detail-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px}.detail-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .detail-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:14px 16px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;transition:all .3s ease;font-weight:300;color:#333;background-color:#f8f9fa}.detail-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .detail-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#75ba9d;box-shadow:0 0 0 3px #75ba9d1a;background-color:#fff}.detail-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px;resize:vertical;line-height:1.5}.action-icons[_ngcontent-%COMP%]{display:flex;gap:20px;margin-top:30px;padding-top:20px;border-top:1px solid #f0f0f0}.action-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer;color:#b5ac9c;transition:all .3s ease;padding:8px;border-radius:6px}.action-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:#75ba9d;background-color:#75ba9d1a}.fa-trash[_ngcontent-%COMP%]:hover{color:#dc3545!important;background-color:#dc35451a!important}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px}.refresh-button[_ngcontent-%COMP%]{background-color:#f0f0f0;border:1px solid #ccc;border-radius:4px;padding:5px 10px;cursor:pointer;display:flex;align-items:center;justify-content:center}.refresh-button[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}@media (max-width: 992px){.content-wrapper[_ngcontent-%COMP%]{flex-direction:column}.left-panel[_ngcontent-%COMP%]{width:100%}}']})}}return r})(),children:[{path:"",component:x.v}]}]}];let W=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[m.iI.forChild(J),m.iI]})}}return r})();var Q=l(8355),H=l(9213),q=l(5351);let K=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[u.MD,W,c.YN,Q.SidebarModule,H.m_,v.Hl,c.X1,q.hM]})}}return r})()}}]);